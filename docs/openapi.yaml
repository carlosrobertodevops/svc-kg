openapi: 3.1.0
info:
    title: svc-kg
    version: v1.7.20
    description: |
        Micro serviço de Knowledge Graph (vis.js / PyVis).
        - **svc-kg** (também referido como **“sic-kg”**)
        - Visualizações: `/v1/vis/visjs`, `/v1/vis/pyvis`
        - Ops: `/live`, `/health`, `/ready`, `/ops/status`

servers:
  - url: /

tags:
  - name: graph
    description: Endpoints de dados brutos do grafo.
  - name: viz
    description: Visualizações do grafo (vis.js / PyVis).
  - name: ops
    description: Operação & saúde (Coolify, Supabase, Redis).

paths:
    /v1/graph/membros:
        get:
            tags: [ graph ]
            summary: Retorna grafo (nodes/edges)
            parameters:
              - in: query
                name: faccao_id
                schema: { type: integer, nullable: true }
              - in: query
                name: include_co
                schema: { type: boolean, default: true }
              - in: query
                name: max_pairs
                schema: { type: integer, default: 8000, minimum: 1, maximum: 200000 }
              - in: query
                name: max_nodes
                schema: { type: integer, default: 2000, minimum: 100, maximum: 20000 }
              - in: query
                name: max_edges
                schema: { type: integer, default: 4000, minimum: 100, maximum: 200000 }
              - in: query
                name: cache
                schema: { type: boolean, default: true }
            responses:
                "200":
                    description: OK
                    content:
                        application/json:
                            schema:
                                type: object
                                properties:
                                    nodes: { type: array, items: { type: object } }
                                    edges: { type: array, items: { type: object } }

    /v1/vis/visjs:
        get:
            tags: [ viz ]
            summary: Visualização vis-network (HTML)
            parameters:
              - in: query
                name: source
                schema: { type: string, enum: [ server, client ], default: server }
            responses:
                "200": { description: HTML }

    /v1/vis/pyvis:
        get:
            tags: [ viz ]
            summary: Visualização PyVis (HTML)
            responses:
                "200": { description: HTML }

    /live:
        get:
            tags: [ ops ]
            summary: Liveness
            responses: { "200": { description: OK, content: { text/plain: {} } } }

    /health:
        get:
            tags: [ ops ]
            summary: Health check
            parameters:
              - in: query
                name: deep
                schema: { type: boolean, default: false }
            responses:
                "200": { description: OK }
                "503": { description: Serviço degradado }

    /ready:
        get:
            tags: [ ops ]
            summary: Readiness
            responses:
                "200": { description: OK }
                "503": { description: Não pronto }

    /ops/status:
        get:
            tags: [ ops ]
            summary: Status operacional
            responses:
                "200": { description: OK }
